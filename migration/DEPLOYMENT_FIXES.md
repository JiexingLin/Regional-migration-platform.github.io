# Vercel éƒ¨ç½²é—®é¢˜ä¿®å¤æ–¹æ¡ˆ

## é—®é¢˜æ€»ç»“

1. âœ… **å·²ä¿®å¤**: Vercelæž„å»ºé‡åˆ° `serpapi/__pycache__/__version__.cpython-39.pyc` æ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯
2. âœ… **å·²ä¿®å¤**: `chat_service.py` è¢«Vercelè¯¯è®¤ä¸ºAPIç«¯ç‚¹çš„é—®é¢˜

## æ ¹æœ¬åŽŸå› ä¸Žè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: åŒ…å†²çªé—®é¢˜ âœ… å·²ä¿®å¤

**åŽŸå› **: `requirements.txt` ä¸­åŒæ—¶åŒ…å«äº†ä¸¤ä¸ªå†²çªçš„åŒ…ï¼š
- `serpapi==0.1.5` (æ—§åŒ…ï¼Œæœ‰é—®é¢˜)
- `google-search-results==2.4.2` (æ­£ç¡®çš„åŒ…)

**è§£å†³æ–¹æ¡ˆ**: 
- âœ… ä»Ž `requirements.txt` ç§»é™¤ `serpapi==0.1.5`
- âœ… ä¿ç•™ `google-search-results==2.4.2`
- âœ… ç§»é™¤ä¸éœ€è¦çš„ `aiohttp` ä¾èµ–

### é—®é¢˜2: chat_service.py ä½œä¸ºAPIç«¯ç‚¹é—®é¢˜ âœ… å·²ä¿®å¤

**åŽŸå› **: Vercel è‡ªåŠ¨å°† `api/` ç›®å½•ä¸‹çš„æ‰€æœ‰ `.py` æ–‡ä»¶å½“ä½œ serverless å‡½æ•°ï¼Œä½† `chat_service.py` åªæ˜¯æœåŠ¡ç±»

**è§£å†³æ–¹æ¡ˆ**:
- âœ… ç§»åŠ¨ `chat_service.py` åˆ° `lib/chat_service.py`
- âœ… åˆ›å»º `lib/__init__.py` ä½¿å…¶æˆä¸ºPythonåŒ…
- âœ… æ›´æ–°æ‰€æœ‰å¯¼å…¥è¯­å¥ä¸º `from lib.chat_service import ChatBotService`
- âœ… åœ¨APIæ–‡ä»¶ä¸­æ·»åŠ Pythonè·¯å¾„è®¾ç½®

### é—®é¢˜3: Pythonå­—èŠ‚ç ç¼“å­˜é—®é¢˜ âœ… å·²ä¿®å¤

**è§£å†³æ–¹æ¡ˆ**:
- âœ… æ·»åŠ  `PYTHONDONTWRITEBYTECODE=1` çŽ¯å¢ƒå˜é‡
- âœ… æ›´æ–° `.vercelignore` å¿½ç•¥ç¼“å­˜æ–‡ä»¶
- âœ… ç¡®ä¿ `lib/` ç›®å½•ä¸è¢«å¿½ç•¥ï¼ˆ`!lib/`ï¼‰

## å½“å‰é¡¹ç›®ç»“æž„

```
migration/
â”œâ”€â”€ api/                    # Vercel APIå‡½æ•°
â”‚   â”œâ”€â”€ chat.py            # âœ… èŠå¤©APIç«¯ç‚¹
â”‚   â”œâ”€â”€ health.py          # âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
â”‚   â”œâ”€â”€ local_migration.py # âœ… ç§»ä½æœç´¢ç«¯ç‚¹
â”‚   â”œâ”€â”€ main.py            # FastAPIåº”ç”¨
â”‚   â””â”€â”€ requirements.txt   # Pythonä¾èµ–
â”œâ”€â”€ lib/                   # ðŸ†• æœåŠ¡ç±»åº“
â”‚   â”œâ”€â”€ __init__.py       # PythonåŒ…åˆå§‹åŒ–
â”‚   â””â”€â”€ chat_service.py   # ðŸ†• èŠå¤©æœåŠ¡ç±»
â””â”€â”€ vercel.json           # Vercelé…ç½®
```

## éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### âœ… å¿…éœ€çš„çŽ¯å¢ƒå˜é‡
ç¡®ä¿åœ¨Vercelä¸­è®¾ç½®ï¼š
- `GOOGLE_API_KEY`: Google AI APIå¯†é’¥
- `SERPAPI_API_KEY`: SerpAPIå¯†é’¥ (å¯é€‰ä½†æŽ¨è)
- `PYTHONDONTWRITEBYTECODE`: "1" (é˜²æ­¢å­—èŠ‚ç é—®é¢˜)

### âœ… ä»£ç å¯¼å…¥éªŒè¯
æ‰€æœ‰ä»£ç æ–‡ä»¶ä½¿ç”¨ç»Ÿä¸€çš„å¯¼å…¥æ–¹å¼ï¼š
```python
from lib.chat_service import ChatBotService  # âœ… æ­£ç¡®
```

### âœ… Pythonè·¯å¾„è®¾ç½®
APIæ–‡ä»¶ä¸­åŒ…å«è·¯å¾„è®¾ç½®ï¼š
```python
# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(current_dir)
if project_root not in sys.path:
    sys.path.insert(0, project_root)
```

## éªŒè¯æ­¥éª¤

### 1. æž„å»ºéªŒè¯
- Vercelå‡½æ•°åˆ—è¡¨ä¸­åº”è¯¥åªæ˜¾ç¤ºAPIç«¯ç‚¹
- ä¸åº”è¯¥å‡ºçŽ° `chat_service` å‡½æ•°

### 2. åŠŸèƒ½éªŒè¯
éƒ¨ç½²åŽæµ‹è¯•ä»¥ä¸‹ç«¯ç‚¹ï¼š
- âœ… `/api/health` - æ£€æŸ¥æœåŠ¡çŠ¶æ€å’ŒçŽ¯å¢ƒå˜é‡
- âœ… `/api/chat` - èŠå¤©æœºå™¨äººåŠŸèƒ½ï¼ˆæµå¼å“åº”ï¼‰
- âœ… `/api/migration/search` - ç§»ä½æœç´¢åŠŸèƒ½
- âœ… `/api/local_migration` - æœ¬åœ°åŒ–æœç´¢

## å½“å‰åŒ…ä¾èµ–

### migration/api/requirements.txt (Vercel å‡½æ•°)
```
google-generativeai>=0.7.0,<0.8.0
google-search-results>=2.4.0,<3.0.0
requests>=2.31.0,<3.0.0
```

### migration/requirements.txt (æœ¬åœ°å¼€å‘)
```
google-generativeai==0.7.2
google-search-results==2.4.2
requests==2.31.0
```

## æ•…éšœæŽ’é™¤

### å¦‚æžœä»ç„¶é‡åˆ°å¯¼å…¥é—®é¢˜

1. **æ¸…ç©º Vercel æž„å»ºç¼“å­˜**:
   ```bash
   vercel --force
   ```

2. **æ£€æŸ¥Pythonè·¯å¾„**:
   - ç¡®ä¿ `lib/` ç›®å½•å­˜åœ¨äºŽé¡¹ç›®æ ¹ç›®å½•
   - ç¡®ä¿ `lib/__init__.py` æ–‡ä»¶å­˜åœ¨
   - æ£€æŸ¥å¯¼å…¥è¯­å¥æ˜¯å¦æ­£ç¡®

3. **æ£€æŸ¥ .vercelignore**:
   - ç¡®ä¿åŒ…å« `!lib/` è§„åˆ™
   - ç¡®ä¿ä¸å¿½ç•¥å¿…è¦çš„æœåŠ¡æ–‡ä»¶

### å¦‚æžœå‡½æ•°è¶…æ—¶

1. **æ£€æŸ¥æµå¼å“åº”**:
   - ç¡®ä¿ç«‹å³å‘é€å¿ƒè·³åŒ…
   - æ£€æŸ¥å¼‚æ­¥å‡½æ•°çš„å®žçŽ°

2. **çŽ¯å¢ƒå˜é‡**:
   - éªŒè¯ API å¯†é’¥è®¾ç½®æ­£ç¡®
   - æ£€æŸ¥æœåŠ¡åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ

## æ³¨æ„äº‹é¡¹

1. **ç›®å½•ç»“æž„**: `lib/` ç›®å½•ç”¨äºŽå­˜æ”¾æœåŠ¡ç±»ï¼Œ`api/` ç›®å½•åªç”¨äºŽAPIç«¯ç‚¹
2. **åŒ…ç‰ˆæœ¬ç®¡ç†**: é¿å…åŒæ—¶å®‰è£…å†²çªçš„PythonåŒ…
3. **ç¼“å­˜é—®é¢˜**: Pythonå­—èŠ‚ç æ–‡ä»¶å¯èƒ½å¯¼è‡´Vercelæž„å»ºå¤±è´¥
4. **çŽ¯å¢ƒå˜é‡**: ç¡®ä¿ç”Ÿäº§çŽ¯å¢ƒä¸­è®¾ç½®äº†æ‰€æœ‰å¿…éœ€çš„APIå¯†é’¥
5. **å¯¼å…¥ä¸€è‡´æ€§**: æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„å¯¼å…¥è¯­å¥
6. **è·¯å¾„è®¾ç½®**: APIæ–‡ä»¶éœ€è¦æ­£ç¡®çš„Pythonè·¯å¾„è®¾ç½®æ¥æ‰¾åˆ°libç›®å½•

## ç›‘æŽ§å»ºè®®

éƒ¨ç½²åŽç›‘æŽ§ï¼š
- Vercel æž„å»ºæ—¥å¿—
- API å“åº”æ—¶é—´
- é”™è¯¯çŽ‡å’Œå¼‚å¸¸æ—¥å¿—
- çŽ¯å¢ƒå˜é‡é…ç½®çŠ¶æ€ 